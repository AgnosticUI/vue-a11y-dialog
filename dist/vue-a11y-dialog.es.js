import{ref as t,computed as e,onMounted as i,onUnmounted as o,nextTick as s,openBlock as n,createBlock as a,Teleport as l,createVNode as r,renderSlot as d,createCommentVNode as h,createTextVNode as u,toDisplayString as c}from"vue";var f=['a[href]:not([tabindex^="-"])','area[href]:not([tabindex^="-"])','input:not([type="hidden"]):not([type="radio"]):not([disabled]):not([tabindex^="-"])','input[type="radio"]:not([disabled]):not([tabindex^="-"])','select:not([disabled]):not([tabindex^="-"])','textarea:not([disabled]):not([tabindex^="-"])','button:not([disabled]):not([tabindex^="-"])','iframe:not([tabindex^="-"])','audio[controls]:not([tabindex^="-"])','video[controls]:not([tabindex^="-"])','[contenteditable]:not([tabindex^="-"])','[tabindex]:not([tabindex^="-"])'];function p(t){this._show=this.show.bind(this),this._hide=this.hide.bind(this),this._maintainFocus=this._maintainFocus.bind(this),this._bindKeypress=this._bindKeypress.bind(this),this.$el=t,this.shown=!1,this._id=this.$el.getAttribute("data-a11y-dialog")||this.$el.id,this._previouslyFocused=null,this._listeners={},this.create()}function y(t,e){return i=(e||document).querySelectorAll(t),Array.prototype.slice.call(i);var i}function b(t){(t.querySelector("[autofocus]")||t).focus()}function g(){y("[data-a11y-dialog]").forEach((function(t){new p(t)}))}p.prototype.create=function(){return this.$el.setAttribute("aria-hidden",!0),this.$el.setAttribute("aria-modal",!0),this.$el.setAttribute("tabindex",-1),this.$el.hasAttribute("role")||this.$el.setAttribute("role","dialog"),this._openers=y('[data-a11y-dialog-show="'+this._id+'"]'),this._openers.forEach(function(t){t.addEventListener("click",this._show)}.bind(this)),this._closers=y("[data-a11y-dialog-hide]",this.$el).concat(y('[data-a11y-dialog-hide="'+this._id+'"]')),this._closers.forEach(function(t){t.addEventListener("click",this._hide)}.bind(this)),this._fire("create"),this},p.prototype.show=function(t){return this.shown||(this._previouslyFocused=document.activeElement,this.$el.removeAttribute("aria-hidden"),this.shown=!0,b(this.$el),document.body.addEventListener("focus",this._maintainFocus,!0),document.addEventListener("keydown",this._bindKeypress),this._fire("show",t)),this},p.prototype.hide=function(t){return this.shown?(this.shown=!1,this.$el.setAttribute("aria-hidden","true"),this._previouslyFocused&&this._previouslyFocused.focus&&this._previouslyFocused.focus(),document.body.removeEventListener("focus",this._maintainFocus,!0),document.removeEventListener("keydown",this._bindKeypress),this._fire("hide",t),this):this},p.prototype.destroy=function(){return this.hide(),this._openers.forEach(function(t){t.removeEventListener("click",this._show)}.bind(this)),this._closers.forEach(function(t){t.removeEventListener("click",this._hide)}.bind(this)),this._fire("destroy"),this._listeners={},this},p.prototype.on=function(t,e){return void 0===this._listeners[t]&&(this._listeners[t]=[]),this._listeners[t].push(e),this},p.prototype.off=function(t,e){var i=(this._listeners[t]||[]).indexOf(e);return i>-1&&this._listeners[t].splice(i,1),this},p.prototype._fire=function(t,e){var i=this._listeners[t]||[],o=new CustomEvent(t,{detail:e});this.$el.dispatchEvent(o),i.forEach(function(t){t(this.$el,e)}.bind(this))},p.prototype._bindKeypress=function(t){this.$el.contains(document.activeElement)&&(this.shown&&27===t.which&&"alertdialog"!==this.$el.getAttribute("role")&&(t.preventDefault(),this.hide(t)),this.shown&&9===t.which&&function(t,e){var i=function(t){return y(f.join(","),t).filter((function(t){return!!(t.offsetWidth||t.offsetHeight||t.getClientRects().length)}))}(t),o=i.indexOf(document.activeElement);e.shiftKey&&0===o?(i[i.length-1].focus(),e.preventDefault()):e.shiftKey||o!==i.length-1||(i[0].focus(),e.preventDefault())}(this.$el,t))},p.prototype._maintainFocus=function(t){!this.shown||t.target.closest('[aria-modal="true"]')||t.target.closest("[data-a11y-dialog-ignore-focus-trap]")||b(this.$el)},"undefined"!=typeof document&&("loading"===document.readyState?document.addEventListener("DOMContentLoaded",g):window.requestAnimationFrame?window.requestAnimationFrame(g):window.setTimeout(g,16));const m={name:"Vue3A11yDialog",props:{id:{type:String,required:!0},appRoot:{type:String,required:!0},dialogRoot:{type:String,required:!0},classNames:{type:Object,default:()=>({container:"dialog-container",document:"dialog-content",overlay:"dialog-overlay",element:"dialog-element",title:"dialog-title",closeButton:"dialog-close"})},role:{type:String,required:!1,default:"dialog",validator:t=>["dialog","alertdialog"].includes(t)},titleId:{type:String,default:""},closeButtonLabel:{type:String,default:"Close this dialog window"},closeButtonPosition:{type:String,required:!1,default:"first",validator:t=>["first","last","none"].includes(t)}},emits:["dialogRef"],setup(n,{emit:a}){let l;const r=t(null),d=e((()=>n.dialogRoot||n.appRoot)),h=e((()=>n.titleId||`${n.id}-title`)),u=e((()=>["dialog","alertdialog"].includes(n.role)?n.role:"dialog"));i((()=>{(async()=>{await s(),l=new p(r.value,d.value||n.appRoot),a("dialogRef",l)})()}));return o((()=>{l&&l.destroy(),a("dialogRef")})),{dialog:l,close:()=>{l.hide()},portalTarget:d,fullTitleId:h,roleAttribute:u,rootElement:r}}},v=u(c("×")),_=u(c("×"));m.render=function(t,e,i,o,s,u){return n(),a(l,{to:o.portalTarget},[r("div",{id:i.id,ref:"rootElement",class:i.classNames.container,role:o.roleAttribute,"aria-hidden":"true","aria-labelledby":o.fullTitleId},[r("div",{"data-a11y-dialog-hide":"",tabIndex:"-1",class:i.classNames.overlay,onClick:e[1]||(e[1]=t=>"alertdialog"===i.role?void 0:o.close)},null,2),r("div",{role:"document",class:i.classNames.document},["first"==i.closeButtonPosition?(n(),a("button",{key:0,"data-a11y-dialog-hide":"",type:"button","aria-label":i.closeButtonLabel,class:i.classNames.closeButton,onClick:e[2]||(e[2]=(...t)=>o.close&&o.close(...t))},[d(t.$slots,"closeButtonContent",{},(()=>[v]))],10,["aria-label"])):h("",!0),r("p",{id:o.fullTitleId,class:i.classNames.title},[d(t.$slots,"title")],10,["id"]),d(t.$slots,"default"),"last"==i.closeButtonPosition?(n(),a("button",{key:1,"data-a11y-dialog-hide":"",type:"button","aria-label":i.closeButtonLabel,class:i.classNames.closeButton,onClick:e[3]||(e[3]=(...t)=>o.close&&o.close(...t))},[d(t.$slots,"closeButtonContent",{},(()=>[_]))],10,["aria-label"])):h("",!0)],2)],10,["id","role","aria-labelledby"])],8,["to"])};var w={install:t=>{t.component("A11yDialog",m)}};export{m as Vue3A11yDialog,w as default};
